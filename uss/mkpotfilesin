#!/bin/bash
# $Id$
#
# po strings update
#
# makes po/POTFILES.in
#
# GPL (c) 2003 Geert Stappers  <stappers@stappers.nl>
#

# po.sible effected files
PPI=po/POTFILES.in
PCL=po/ChangeLog

# fresh files
FPPI=${PPI}.fresh
FPCL=${PCL}.fresh
# 

# header
cat << HERE > ${FPPI}
# List of source files containing translatable strings.
# Generated by upstream script uss/mkpotfilesin
HERE

# several enumerated files
cat << HERE >> ${FPPI}
data/conglomerate.desktop.in
data/conglomerate.schemas.in
HERE

# found glade files
find glade -name "*.glade" | sort >> ${FPPI}

# found C-soure files, this is the reason why this script exists
find src -name "*.c" | sort >> ${FPPI}

# mayby other enumerated files

# tailer
echo "# end of file" >> ${FPPI}


function make_fresh_po_ChangeLog
{
  date +"%Y-%m-%d  mkpotfiles runner  <@>" > ${FPCL}
  echo >> ${FPCL}
  echo "	* POTFILES.in" >> ${FPCL}
  echo "	fresh generated, this will effect several PO files" >> ${FPCL}
  echo >> ${FPCL}
  cat ${PCL} >> ${FPCL}
}

# Okay, we have the fresh file, but do we need to do more
if [ $( diff ${PPI} ${FPPI} | wc -l ) -ne 0 ]
then
	# use the fresh POTFILES.in
	mv ${FPPI} ${PPI}
	# update ChangeLog
	make_fresh_po_ChangeLog
	mv ${FPCL} ${PCL}
	# ask user for help
	echo put your name in po/ChangeLog
	echo and do a CVS commit
else
	: # kiep kwijt  ;-)
fi

# cleanup
# rm -f ${FPPI} ${FPCL}  # we did a rename, no need for remove

# end of script
