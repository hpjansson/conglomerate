#!/bin/bash
# $Id$
VERSION=$( echo '$Revision$' | awk '{ print $2 }' )
#
# po strings update
#
# makes po/POTFILES.in
#
# GPL (c) 2003 Geert Stappers  <stappers@stappers.nl>
#

# po.sible effected files
PPI=po/POTFILES.in
PCL=po/ChangeLog

# fresh files
FPPI=${PPI}.fresh
FPCL=${PCL}.fresh
# 

# header
cat << HERE > ${FPPI}
# List of source files containing translatable strings.
# Generated by upstream script uss/mkpotfilesin
HERE

# several enumerated files
cat << HERE >> ${FPPI}
data/conglomerate.desktop.in
data/conglomerate.schemas.in
HERE

# document types
find examples -name "*.xds.in" | sort >> ${FPPI}

# found glade files
find glade -name "*.glade" | sort >> ${FPPI}

# found C-soure files, this is the reason why this script exists
find src -name "*.c" | sort >> ${FPPI}

# mayby other enumerated files

# tailer
echo "# end of file" >> ${FPPI}


function make_fresh_po_ChangeLog
{
 #date +"%F  mkpotfiles runner  <@>" > ${FPCL}
  date +"%F  Geert Stappers  <stappers@stappers.nl>" > ${FPCL}
  echo >> ${FPCL}
  echo -e "\tPOTFILES.in:" >> ${FPCL}
  echo -e "\tRegenerated, with uss/mkpotfilesin version ${VERSION}," >> ${FPCL}
  echo -e "\tthis will effect the .po files." >> ${FPCL}
  echo >> ${FPCL}
  cat ${PCL} >> ${FPCL}
}

# Okay, we have the fresh file, but do we need to do more
if [ $( diff ${PPI} ${FPPI} | wc -l ) -gt 0 ]
then
	# use the fresh POTFILES.in
	mv ${FPPI} ${PPI}
	# update ChangeLog
	make_fresh_po_ChangeLog
	mv ${FPCL} ${PCL}
	# ask user for help
	echo update the name in po/ChangeLog
	echo and do 
	echo  cvs commit -m\"po/ updated with $0\" po
else
	: # kiep kwijt  ;-)
fi

# cleanup
rm -f ${FPPI} ${FPCL}

# end of script
